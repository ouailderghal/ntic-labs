---
- hosts: servers
  user: vagrant
  become: yes

  tasks:
    - name: Update cache and full system upgrade
      tags: update,upgrade,cache_update
      dnf:
        name: '*'
        state: latest
        update_cache: yes

    - name: Install administation utilities
      tags: admin_utils,utils
      dnf:
        name: 
          - vim
          - tmux

    - name: Configure DNS service
      tags: dns
      block:
        - name: Install DNS and DNS utilities
          dnf:
            name:
              - bind
              - bind-utils
            state: present

        - name: Copy named configuration file
          tags: named,named_config
          copy:
            src: config/bind/named.conf
            dest: /etc/named.conf
            owner: root
            group: named
            mode: 0640
            backup: yes

        - name: Copy zones configuration file
          tags: named,zones_config
          copy:
            src: config/bind/named.conf.local
            dest: /etc/named/named.conf.local
            owner: root
            group: named
            mode: 0640

        - name: Copy zones database files
          tags: named,zones_db
          copy:
            src: config/bind/zones/
            dest: /etc/named/zones/
            owner: root
            group: named
            mode: 0640

        - name: Enable and run named service
          tags: named,named_service
          service:
            name: named
            state: started
            enabled: yes

